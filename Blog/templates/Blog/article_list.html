{% extends 'Blog/base.html' %}

{% load corkran_tags %}

{% block title %}{% endblock %}

{% block content %}

{% block header-card %}{% endblock %}


<!-- Search bar -->
<form>
	<div class="input-bar">
		<input class="input-box" type="text" name="search" placeholder="Search..." value="{{ query }}"">
		<button class="button" type="submit"><i class="fas fa-search"></i></button>
	</div>
</form>


{% if searched and articles %}
<!-- Search results counter -->
<div class="closer-below search-info">
	Result{% if page_obj.paginator.count != 1 %}s{% endif %} {{ page_obj.start_index }} to {{ page_obj.end_index }} of {{ page_obj.paginator.count }}
</div>
{% endif %}


{% for article in articles %}
<!-- Article preview -->
<div class="article article-preview card">
	{% if article.thumbnail %}
	<!-- Thumbnail -->
	<div 
		data-href="https://ik.imagekit.io/f92sz8hl8b/{{ article.thumbnail.url }}" 
		data-srcset="
			https://ik.imagekit.io/f92sz8hl8b/{{ article.thumbnail.url }}?tr=w-1100 3000w, 
			https://ik.imagekit.io/f92sz8hl8b/{{ article.thumbnail.url }}?tr=w-880 1500w,
			https://ik.imagekit.io/f92sz8hl8b/{{ article.thumbnail.url }}?tr=w-700 1000w,
			https://ik.imagekit.io/f92sz8hl8b/{{ article.thumbnail.url }}?tr=w-500 600w"   
		data-sizes="100vw"
		class="progressive replace article-thumbnail">

		<!-- Blurred loader image -->
		<img src="https://ik.imagekit.io/f92sz8hl8b/{{ article.thumbnail.url }}?tr=w-300" class="preview" alt="Article Thumbnail">
	</div>
	{% endif %}

	<!-- Header -->
	<div class="header">
		<!-- Date -->
		<div class="date subheading">{{ article.date|date:"F jS, Y" }}</div>

		<!-- Title -->
		<div class="heading">
			<a href="{% url 'article-detail' article.id article.slug %}" class="unformatted"
				title='Read "{{ article.title }}"'>
				{{ article.title }}
			</a>
		</div>

		<!-- Author -->
		<div class="subheading">
			By
			<a href="{% url 'author-sorted-articles' article.author %}"
				title="Articles by {{ article.author.username }}">{{ article.author.username }}
			</a>
		</div>
	</div>

	<!-- Content container -->
	<a class="unformatted" href="{% url 'article-detail' article.id article.title %}" title='Read "{{ article.title }}"'>
		<!-- Content -->
		<div class="clickable">{{ article.content|urlizetrunc:30|linebreaks|truncatechars:1000 }}</div>

		{% if article.content|length > 1000 %}
		<!-- Fade truncate -->
		<div class="fade"></div>
		{% endif %}
	</a>
</div>
{% empty %}
{% if searched %}
<!-- Empty search -->
{% block empty-search-card %}{% endblock %}
{% else %}
<!-- No articles and not a search -->
{% block no-articles-card %}{% endblock %}
{% endif %}
{% endfor %}


{% if page_obj.paginator.num_pages > 1 %}
<!-- Paginator -->
<div class="paginator">
	<!-- First page -->
	<a href="?{% param_replace page=1 %}" title="First Page" class="unformatted">
		<i class="fas fa-arrow-circle-left"></i>
	</a>

	{% for page in page_obj.paginator.page_range|cut_page_range:page_obj.number %}
	{% if page == page_obj.number %}
	<!-- Current page -->
	<i class="current fas fa-map-marker-alt" title="Page {{ page_obj.number }}"></i>
	{% else %}
	<!-- Page link -->
	<a href="?{% param_replace page=page %}" title="Page {{ page }}" class="unformatted">{{ page }}</a>
	{% endif %}
	{% endfor %}

	<!-- Last Page -->
	<a href="?{% param_replace page=page_obj.paginator.num_pages %}" title="Last Page" class="unformatted">
		<i class="fas fa-arrow-circle-right"></i>
	</a>
</div>
{% endif %}


{% if user.is_authenticated %}
<!-- New article button -->
<a href="{% url 'create-article' %}" class="floating-btn" title="New Article">
	<i class="fas fa-pen-nib"></i>
</a>
{% endif %}

{% endblock %}